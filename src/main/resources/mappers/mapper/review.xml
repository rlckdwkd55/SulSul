<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sulsulmarket.sulsul.review.mapper.ReviewMapper">

    <insert id="writeReview">
        INSERT INTO REVIEW(
             REVIEW_NO
            ,MEMBER_ID
            ,DETAIL_NO
            ,REVIEW_CONTENT
            ,REVIEW_SCORE
            ,REVIEW_DATE
            ,REVIEW_STATUS
            ,REVIEW_IMAGE
        ) VALUES(
             #{REVIEW_NO}
            ,#{MEMBER_ID}
            ,#{DETAIL_NO}
            ,#{REVIEW_CONTENT}
            ,#{REVIEW_SCORE}
            ,NOW()
            ,#{REVIEW_STATUS}
            ,#{REVIEW_OLDIMAGE}
        )
    </insert>
    
    <select id="getReviewListAllByOrderDetail" resultType="com.sulsulmarket.sulsul.review.dto.ReviewOrderDetailDTO">
        SELECT *
          FROM REVIEW A JOIN ORDER_DETAIL B
        ON A.ORDER_NO = B.ORDER_NO
          ORDER BY REVIEW_DATE DESC
    </select>

    <select id="getReviewListAllByMemberId" resultType="com.sulsulmarket.sulsul.review.dto.ReviewOrderByMemberId">
        SELECT *
          FROM REVIEW A
         JOIN MEMBER B ON A.MEMBER_ID = B.MEMBER_ID
          JOIN ORDER_DETAIL C ON A.ORDER_NO = C.ORDER_NO
         WHERE B.MEMBER_ID = #{MEMBER_ID}
    </select>

    <update id="updateReview" parameterType="com.sulsulmarket.sulsul.review.dto.ReviewDTO">
        UPDATE REVIEW
        <set>
            <if test="REVIEW_IMAGE != null">
            </if>
        </set>
    </update>
</mapper>